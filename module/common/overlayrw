#!/system/bin/sh
MODP="/data/overlayfs"
TMPP="/data/overlayfs/tmp"
if [ "$1" == "-ro" ];then
mkdir -p "$MODP$2"
setfattr -n trusted.overlay.opaque -v y $MODP$2 2>/dev/null
mkdir -p "$TMPP$2"
chcon -Rh "$(ls -nZld "$2" | awk '{print $5}')" "$MODP$2"
chmod -R 755 "$MODP$2"
chown -Rh $(ls -nZld "$2" | awk '{print $3":"$4}') "$MODP$2"
mount -v -t overlay kakathic -o "lowerdir=$MODP$TV:$2" "$2" && echo "Mount: $2 done"
[ "$(grep -cm1 "$2" /data/overlayfs/tmp/partition)" == 1 ] || echo "$2" >> /data/overlayfs/tmp/partition
elif [ -d "$1" ];then
mkdir -p "$MODP$1"
setfattr -n trusted.overlay.opaque -v y $MODP$1 2>/dev/null
mkdir -p "$TMPP$1"
chcon -Rh "$(ls -nZld "$1" | awk '{print $5}')" "$MODP$1"
chmod -R 755 "$MODP$1"
chown -Rh $(ls -nZld "$1" | awk '{print $3":"$4}') "$MODP$1"
mount -v -t overlay kakathic -o "upperdir=$MODP$1,lowerdir=$1,workdir=$TMPP$1" "$1" && echo "Mount: $1 done"
[ "$(grep -cm1 "$1" /data/overlayfs/tmp/partition)" == 1 ] || echo "$1" >> /data/overlayfs/tmp/partition
elif [ -z "$1" ] || [ "$1" == "--help" ];then
echo "Use: overlayrw [path_folder_rw]"
echo
echo "Instruct: overlayrw /system/app"
echo
echo "After running the command, you can edit files in that directory"
else
echo "Error: Path $1 is not directory";
exit 1
fi
